<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#b8e0d2">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>IHCA Day-1 風險板 | 電子白板</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .whiteboard-page { background: #f5f0f9; min-height: 100vh; color: #4a4458; }
    .whiteboard-header {
      background: linear-gradient(135deg, #b8e0d2 0%, #a8d5c8 50%, #95c9bc 100%);
      color: #2d6a4f;
      padding: 0.75rem 1.5rem;
      padding-right: 10rem;
      text-align: center;
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      font-weight: 600;
      box-shadow: 0 2px 12px rgba(45, 106, 79, 0.15);
      position: relative;
    }
    .whiteboard-header small { display: block; font-size: 0.65em; font-weight: 400; opacity: 0.9; margin-top: 0.2rem; color: #3d7a63; }
    .whiteboard-header-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.9rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: #2d6a4f;
      background: rgba(255,255,255,0.9);
      border: 2px solid rgba(45, 106, 79, 0.4);
      border-radius: 10px;
      text-decoration: none;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      white-space: nowrap;
    }
    .whiteboard-header-btn:hover {
      background: #fff;
      border-color: #2d6a4f;
      color: #1e4d3d;
    }
    .whiteboard-summary {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.6rem 1rem;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6rem;
      text-align: center;
    }
    @media (max-width: 600px) {
      .whiteboard-summary { grid-template-columns: 1fr; padding: 0.5rem 0.75rem; gap: 0.4rem; }
    }
    .whiteboard-summary-card {
      border-radius: 12px;
      padding: 0.6rem 0.9rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 2px solid rgba(255,255,255,0.8);
    }
    @media (max-width: 600px) {
      .whiteboard-summary-card { padding: 0.45rem 0.65rem; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0 0.5rem; text-align: left; }
    }
    .whiteboard-summary-card.level-low   { background: linear-gradient(160deg, #d4edda 0%, #c5e8d0 100%); color: #2d6a4f; }
    .whiteboard-summary-card.level-mid   { background: linear-gradient(160deg, #fff4d6 0%, #ffe4b8 100%); color: #8b6914; }
    .whiteboard-summary-card.level-high  { background: linear-gradient(160deg, #ffd6e0 0%, #ffc9d4 100%); color: #9d4b5a; }
    .whiteboard-summary-label { font-size: 0.9rem; margin-bottom: 0.15rem; }
    .whiteboard-summary-count { font-size: 1.4rem; letter-spacing: 0.02em; }
    .whiteboard-summary-pct  { font-size: 1rem; opacity: 0.95; margin-top: 0.1rem; }
    @media (max-width: 600px) {
      .whiteboard-summary-label { margin-bottom: 0; font-size: 0.8rem; }
      .whiteboard-summary-count { font-size: 1rem; }
      .whiteboard-summary-pct  { font-size: 0.85rem; margin-top: 0; }
    }
    .whiteboard-main {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.75rem;
      padding: 0 1rem 1rem;
      max-width: 1400px;
      margin: 0 auto;
      align-items: stretch;
    }
    @media (max-width: 900px)  { .whiteboard-main { grid-template-columns: repeat(3, 1fr); gap: 0.6rem; } }
    @media (max-width: 500px)  { .whiteboard-main { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; padding: 0 0.75rem 0.75rem; } }
    .whiteboard-card {
      border-radius: 12px;
      padding: 0.7rem;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 120px;
      border: 2px solid rgba(255,255,255,0.8);
    }
    @media (max-width: 500px) {
      .whiteboard-card { min-height: 100px; padding: 0.5rem; border-radius: 10px; }
      .whiteboard-card-prob { font-size: 1.1rem; }
      .whiteboard-card-level { font-size: 0.75rem; }
      .whiteboard-card-demo { font-size: 0.65rem; margin-top: 0.25rem; }
      .whiteboard-card-bed { font-size: 0.75rem; }
    }
    .whiteboard-card.level-low   { background: linear-gradient(160deg, #d4edda 0%, #c5e8d0 100%); color: #2d6a4f; }
    .whiteboard-card.level-mid   { background: linear-gradient(160deg, #fff4d6 0%, #ffe4b8 100%); color: #8b6914; }
    .whiteboard-card.level-high  { background: linear-gradient(160deg, #ffd6e0 0%, #ffc9d4 100%); color: #9d4b5a; }
    .whiteboard-card-num { font-size: 0.75rem; opacity: 0.85; margin-bottom: 0.2rem; }
    .whiteboard-card-prob { font-size: clamp(1.1rem, 2.5vw, 1.5rem); font-weight: 800; margin: 0.2rem 0; letter-spacing: 0.02em; }
    .whiteboard-card-level { font-size: 0.85rem; font-weight: 600; }
    .whiteboard-card-demo { font-size: 0.7rem; opacity: 0.9; margin-top: 0.35rem; line-height: 1.35; overflow: hidden; text-overflow: ellipsis; }
    .whiteboard-card-bed { font-size: 0.8rem; opacity: 0.9; margin-top: 0.15rem; }
    .whiteboard-header-actions {
      position: absolute;
      top: 50%;
      right: 1rem;
      transform: translateY(-50%);
      display: flex;
      flex-direction: row;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: nowrap;
    }
    .whiteboard-btn-refresh {
      padding: 0.4rem 0.9rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: #2d6a4f;
      background: rgba(255,255,255,0.95);
      border: 2px solid rgba(45, 106, 79, 0.4);
      border-radius: 10px;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .whiteboard-btn-refresh:hover { background: #fff; border-color: #2d6a4f; }
    .whiteboard-footer {
      text-align: center;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      color: #8b7a9e;
    }
    .whiteboard-link { color: #7c6b9a; text-decoration: none; margin-left: 0.5rem; }
    .whiteboard-link:hover { text-decoration: underline; color: #5a4a78; }
  </style>
</head>
<body class="whiteboard-page">
  <header class="whiteboard-header">
    <div class="whiteboard-header-actions">
      <button type="button" class="whiteboard-btn-refresh" id="btn-refresh" aria-label="重新產生示範資料">重新產生</button>
      <a href="index.html" class="whiteboard-header-btn">回主頁</a>
    </div>
    IHCA 24 小時前風險電子白板
    <small id="whiteboard-subtitle">電子白板示範 — 依風險分級顯示</small>
  </header>

  <section class="whiteboard-summary" id="whiteboard-summary" aria-label="病房風險分布">
    <div class="whiteboard-summary-card level-low">
      <div class="whiteboard-summary-label">低風險</div>
      <div class="whiteboard-summary-count" id="summary-low-count">0 人</div>
      <div class="whiteboard-summary-pct" id="summary-low-pct">0 %</div>
    </div>
    <div class="whiteboard-summary-card level-mid">
      <div class="whiteboard-summary-label">中度風險</div>
      <div class="whiteboard-summary-count" id="summary-mid-count">0 人</div>
      <div class="whiteboard-summary-pct" id="summary-mid-pct">0 %</div>
    </div>
    <div class="whiteboard-summary-card level-high">
      <div class="whiteboard-summary-label">高風險</div>
      <div class="whiteboard-summary-count" id="summary-high-count">0 人</div>
      <div class="whiteboard-summary-pct" id="summary-high-pct">0 %</div>
    </div>
  </section>

  <main class="whiteboard-main" id="whiteboard-main" aria-label="病人風險白板">
    <!-- 卡片由 JS 產生，排列與首日白板相同 -->
  </main>

  <footer class="whiteboard-footer">
    本畫面為邏輯式回歸模型之預測示範，僅供臨床決策輔助參考。
    <a href="index.html" class="whiteboard-link">回主頁輸入</a>
  </footer>

  <script src="whiteboardDataGenerator.js"></script>
  <script>
    (function () {
      var levelToClass = { High: 'high', Medium: 'mid', Low: 'low' };
      var levelToLabel = { High: '高風險', Medium: '中度風險', Low: '低風險' };

      function renderWhiteboard(list) {
        if (!list || !list.length) return;
        var total = list.length;
        var high = list.filter(function (p) { return p.risk_level === 'High'; });
        var mid = list.filter(function (p) { return p.risk_level === 'Medium'; });
        var low = list.filter(function (p) { return p.risk_level === 'Low'; });

        document.getElementById('summary-high-count').textContent = high.length + ' 人';
        document.getElementById('summary-high-pct').textContent = (total ? (high.length / total * 100).toFixed(1) : '0') + ' %';
        document.getElementById('summary-mid-count').textContent = mid.length + ' 人';
        document.getElementById('summary-mid-pct').textContent = (total ? (mid.length / total * 100).toFixed(1) : '0') + ' %';
        document.getElementById('summary-low-count').textContent = low.length + ' 人';
        document.getElementById('summary-low-pct').textContent = (total ? (low.length / total * 100).toFixed(1) : '0') + ' %';

        var subtitle = document.getElementById('whiteboard-subtitle');
        if (subtitle) subtitle.textContent = '電子白板示範 — ' + total + ' 位病人 · 每 5 秒自動更新（模擬不同時間風險變化）';

        var main = document.getElementById('whiteboard-main');
        main.innerHTML = '';

        list.forEach(function (p) {
          var level = p.risk_level;
          var card = document.createElement('div');
          card.className = 'whiteboard-card level-' + levelToClass[level];
          card.setAttribute('aria-label', p.patient_id + ' ' + p.bed + ' 風險 ' + p.risk_score);
          card.innerHTML =
            '<div class="whiteboard-card-num">' + p.patient_id + '</div>' +
            '<div class="whiteboard-card-bed">' + p.bed + '</div>' +
            '<div class="whiteboard-card-prob">' + p.risk_score + '</div>' +
            '<div class="whiteboard-card-level">' + levelToLabel[level] + '</div>' +
            '<div class="whiteboard-card-demo">' + (p.key_drivers || '—').replace(/、/g, ' · ') + '</div>';
          main.appendChild(card);
        });
      }

      function run() {
        if (typeof WhiteboardDataGenerator === 'undefined') {
          document.getElementById('whiteboard-main').innerHTML = '<p style="text-align:center;color:#6b7280;padding:2rem;">請確認 whiteboardDataGenerator.js 已載入。</p>';
          return;
        }
        var list = WhiteboardDataGenerator.generate();
        renderWhiteboard(list);
      }

      run();
      document.getElementById('btn-refresh').addEventListener('click', run);
      setInterval(run, 5000);
    })();
  </script>
</body>
</html>
